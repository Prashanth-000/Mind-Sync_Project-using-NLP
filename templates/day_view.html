<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Day View - MindSync Journal</title>
  
  <!-- Professional Font & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root {
      /* -- Matching the Main Page Palette -- */
      --primary-color: #4f46e5;  /* Indigo */
      --secondary-color: #ec4899; /* Pink */
      --accent-color: #f59e0b; /* Amber */
      --background-color: #f8fafc; /* Lighter Slate */
      --card-bg-color: #FFFFFF;
      --text-color: #1f2937;
      --muted-text-color: #6b7280;
      --border-color: #e5e7eb;
    }
    body {
      background-color: var(--background-color);
      font-family: 'Inter', sans-serif;
      color: var(--text-color);
    }
    .content-wrapper {
      max-width: 1100px;
      margin: 0 auto;
    }
    .card {
      background-color: var(--card-bg-color);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.04);
    }
    .table-hover tbody tr:hover {
      background-color: #f9fafb;
    }
    .table thead th {
      border-bottom-width: 1px;
      font-weight: 600;
      color: var(--muted-text-color);
      text-transform: uppercase;
      font-size: 0.8rem;
      letter-spacing: 0.5px;
    }
    pre {
      white-space: pre-wrap;
      margin: 0;
      font-family: inherit;
      background: transparent;
      padding: 0;
      border-radius: 0;
      color: var(--text-color);
    }
    .task-list {
      list-style-type: none;
      padding-left: 0;
      margin-bottom: 0;
    }
    .task-list li {
      padding: 2px 0;
      font-size: 0.9em;
    }
    .text-success {
      color: #22c55e !important;
    }
    .btn-outline-primary {
      border-color: var(--border-color);
      color: var(--muted-text-color);
      font-weight: 500;
      border-radius: 8px;
    }
    .btn-outline-primary:hover {
      background-color: var(--primary-color);
      color: #fff;
      border-color: var(--primary-color);
    }
    .btn-danger {
      background-color: #ef4444;
      border: none;
      font-weight: 500;
      border-radius: 8px;
    }
    .header-title {
        color: var(--text-color);
    }
  </style>
</head>
<body>
  <div class="container content-wrapper my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="header-title mb-0">Journal Entries for <span style="color: var(--primary-color);">{{ date }}</span></h2>
      <a href="/" class="btn btn-outline-primary">← Back to Dashboard</a>
    </div>

    {% if entries %}
      <!-- FIX: Added id to form for JS targeting -->
      <form id="deleteForm" action="{{ url_for('delete_entries') }}" method="POST">
        <input type="hidden" name="date" value="{{ date }}">
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                  <tr>
                    <th style="width:4%" class="ps-3"><input type="checkbox" class="form-check-input" id="masterCheckbox"></th>
                    <th style="width:46%">Journal Content</th>
                    <th style="width:10%">Mood</th>
                    <th style="width:12%">Productivity</th>
                    <th style="width:28%">Tasks</th>
                  </tr>
                </thead>
                <tbody>
                  {% for entry in entries %}
                  <tr>
                    <td class="ps-3"><input type="checkbox" name="entry_ids" value="{{ entry._id }}" class="form-check-input entry-checkbox"></td>
                    <td><pre>{{ entry.journal_text }}</pre></td>
                    <td>{{ entry.mood }}</td>
                    <td>{{ "%.2f"|format(entry.productivity) }}</td>
                    <td>
                      {% if entry.tasks %}
                        <ul class="task-list">
                          {% for task in entry.tasks %}
                            <li>
                              {{ task.task_text }}
                              {% if task.completed %} <span class="text-success fw-bold">✔</span>{% endif %}
                            </li>
                          {% endfor %}
                        </ul>
                      {% else %}
                        <span class="text-muted">—</span>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end mt-3">
            <!-- FIX: Changed to button type, added id, and disabled attribute for JS control -->
            <button type="button" id="deleteButton" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal" disabled>Delete Selected</button>
        </div>
      </form>
    {% else %}
      <div class="card text-center shadow-sm">
        <div class="card-body p-5">
          <h5 class="card-title">No Entries Found</h5>
          <p class="text-muted mb-0">There are no journal entries recorded for this day.</p>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- NEW: Deletion Confirmation Modal -->
  <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to delete the selected journal entries? This action cannot be undone.
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="confirmDeleteButton">Delete Entries</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const deleteButton = document.getElementById('deleteButton');
        const masterCheckbox = document.getElementById('masterCheckbox');
        const checkboxes = document.querySelectorAll('.entry-checkbox');
        const confirmDeleteButton = document.getElementById('confirmDeleteButton');
        const deleteForm = document.getElementById('deleteForm');

        function updateDeleteButtonState() {
            // Enable the delete button only if at least one entry checkbox is checked
            const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
            deleteButton.disabled = !anyChecked;
        }

        // Event listeners for master and individual checkboxes
        if (masterCheckbox) {
            masterCheckbox.addEventListener('change', () => {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = masterCheckbox.checked;
                });
                updateDeleteButtonState();
            });
        }

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateDeleteButtonState);
        });

        // Event listener for the final delete confirmation
        if (confirmDeleteButton) {
            confirmDeleteButton.addEventListener('click', () => {
                deleteForm.submit();
            });
        }

        // Initial state check on page load
        updateDeleteButtonState();
    });
  </script>
</body>
</html>

